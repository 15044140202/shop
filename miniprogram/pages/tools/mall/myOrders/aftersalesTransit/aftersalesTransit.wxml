<view class="container">
  <!-- 订单信息 -->
  <view class="order-info">
    <view class="order-header">
      <text class="order-num">订单号: {{order.orderNum}}</text>
      <text class="order-time">{{order.placeTimeStr}}</text>
    </view>
    <view class="shipping-address">
      <text class="label">收货信息:</text>
      <text>{{order.shoppingAdd.name}} {{order.shoppingAdd.phone}}</text>
      <text>{{order.shoppingAdd.address}} {{order.shoppingAdd.detail}}</text>
    </view>
  </view>

  <!-- 商品列表 -->
  <view class="goods-list">
    <view class="section-title">
      <text>选择发货商品</text>
      <van-button size="mini" type="primary" bind:tap="handleSelectAll">{{isAllSelected ? '取消全选' : '全选'}}</van-button>
    </view>
    <van-checkbox-group value="{{selectedGoods}}">
      <view class="goods-item" wx:for="{{order.goodsList}}" wx:key="goodsId" wx:if="{{item.applyReturnStatus === 0 && item.applyChangeStatus === 0}}">
        <van-checkbox name="{{index}}" value="{{selectedGoods[index]}}" catch:tap="handleGoodsSelect" mark:index="{{index}}"></van-checkbox>
        <image src="{{item.goodsHeadPic}}" mode="aspectFill"></image>
        <view class="goods-info">
          <text class="goods-name">{{item.goodsName}}</text>
          <text class="goods-spec">颜色: {{item.goodsColor}}</text>
          <text class="goods-price">¥{{item.goodsPrice}} x {{item.goodsQuantity}}</text>
          <text class="shipped-count" wx:if="{{shippedGoods[index]}}">已发: {{shippedGoods[index]}}/{{item.goodsQuantity}}</text>
        </view>
        <view class="quantity-selector">
          <van-stepper value="{{selectedGoods[index] || 0}}" min="0" max="{{item.goodsQuantity - (shippedGoods[item.goodsId][item.goodsColorObjName].shippedSum || 0)}}" bind:change="handleGoodsSelectSumChange" mark:index="{{index}}" />
        </view>
      </view>
    </van-checkbox-group>
  </view>

  <!-- 物流信息 -->
  <view class="express-info">
    <view class="section-title">物流信息</view>
    <van-field label="快递公司" placeholder="请输入快递公司名称" value="{{expressCompany}}" bind:change="onExpressCompanyChange" />
    <van-field label="快递单号" placeholder="请输入快递单号" value="{{expressNumber}}" bind:change="onExpressNumberChange" right-icon="scan" bind:click-icon="getExpressNum">
    </van-field>
  </view>

  <!-- 备注信息 -->
  <view class="remarks">
    <view class="section-title">备注</view>
    <van-field label="发货备注" type="textarea" placeholder="可填写发货备注信息" autosize value="{{remarks}}" bind:change="onRemarksChange" />
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <van-button type="primary" block bind:click="handleSubmit">确认发货</van-button>
  </view>

  <van-notify id="van-notify" />
</view>