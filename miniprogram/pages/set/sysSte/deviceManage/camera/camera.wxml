<!--pages/set/sysSte/deviceManage/camera/camera.wxml-->
<import src="../../../../../template/SetMenu/SetMenu" />
<template is="titel" data="{{titel:'设备管理中心'}}" />

<view class="dashboard-container">
  <!-- 账户模块 -->
  <view class="dashboard-card balance-card">
    <view class="card-header">
      <van-icon name="balance-pay" color="#1890ff" size="40rpx" />
      <text class="card-title">账户余额</text>
    </view>
    <view class="card-body">
      <text class="balance-number">{{shop_account.sportShowAmount > 0 ? shop_account.sportShowAmount  : '0.00'}}元</text>
      <view class="operation-group">
        <text class="cost-tip">单次调用成本：{{sportShowCost}}元</text>
        <button class="recharge-btn" type="primary" size="mini" bind:tap="tap" mark:item="topup">立即充值</button>
      </view>
    </view>
  </view>

  <!-- 价格设置模块 -->
  <view class="dashboard-card price-card">
    <view class="card-header">
      <van-icon name="coupon-o" color="#52c41a" size="40rpx" />
      <text class="card-title">服务定价</text>
    </view>
    <view class="card-body">
      <view class="price-input-group">
        <input class="price-input" type="number" placeholder="输入服务价格" value="{{shop_device.sportShowPrice}}" bindinput="input" mark:item="sportShowPrice" />
        <text class="price-unit">元/次</text>
        <button class="save-btn" type="primary" plain size="mini" bind:tap="priceSave">应用价格</button>
      </view>
    </view>
  </view>

  <!-- 设备列表模块 -->
  <view class="dashboard-card device-list-card">
    <view class="card-header">
      <van-icon name="video-o" color="#722ed1" size="40rpx" />
      <text class="card-title">已接入设备（{{shop_device.camera.length}} ）</text>
    </view>
    <view class="device-list">
      <view class="device-item" wx:for="{{shop_device.camera}}" wx:key="index">
        <view class="device-header">
          <text class="device-id">ID: {{item.cameraNum}}</text>
          <van-icon name="delete" color="#ff4d4f" size="40rpx" bind:tap="delete" mark:index="{{index}}" />
        </view>

        <view class="device-status">
          <van-tag type="{{deviceState[index] === '1' ? 'success' : 'danger'}}" size="large">
            {{deviceState[index] === '1' ? '在线' : '离线'}}
          </van-tag>
          <text class="status-time">最后在线：{{item.lastOnline || '--'}}</text>
        </view>

        <view class="channel-list">
          <view class="channel-item" wx:for="{{item.channel}}" wx:for-index="channelIndex" wx:for-item="channelItem" wx:key="channelIndex">
            <view class="channel-info">
              <van-icon name="tv-o" size="36rpx" />
              <text class="channel-name">通道 {{channelIndex + 1}}</text>
            </view>
            <picker class="table-picker" range="{{shop_table}}" range-key="tableNum" value="{{channelItem.bindTable}}" bindchange="chengeBindTable" mark:index="{{index}}" mark:channelIndex="{{channelIndex}}">
              <text class="bind-info">
                {{channelItem.bindTable === 0 ? '点击绑定桌台' : '已绑定#' + channelItem.bindTable  + '号桌台'}}
              </text>
            </picker>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 添加设备模块 -->
  <view class="dashboard-card add-device-card">
    <view class="card-header">
      <van-icon name="add-o" color="#13c2c2" size="40rpx" />
      <text class="card-title">添加新设备</text>
    </view>
    <view class="device-form">
      <view class="form-item">
        <text class="form-label">设备序列号</text>
        <view class="input-group">
          <input class="form-input" type="text" value="{{cameraNum}}" placeholder="请输入大华设备SN码" bindinput="input" mark:item="cameraNum" />
          <van-icon name="scan" size="48rpx" color="#1890ff" bind:tap="scan" class="scan-icon" />
        </view>
      </view>

      <view class="form-item">
        <text class="form-label">安全验证码</text>
        <input class="form-input" type="password" value="{{cameraSecurityCode}}" placeholder="请输入设备安全码" bindinput="input" mark:item="cameraSecurityCode" />
      </view>

      <view class="form-item">
        <text class="form-label">通道配置</text>
        <input class="form-input" type="number" value="{{channel}}" placeholder="请输入通道总数" bindinput="input" mark:item="channel" />
      </view>
      <view style=" display: flex; flex-direction: row; justify-content: space-between; align-items: center; width: 100%; ">
        <text class="form-label">品牌选择 : </text>
        <picker mode="selector" style="width: 50%;" range="{{cameraBrandArr}}" bindchange="brandChange">
          <view style="width: 100%; text-align: center; height: 100%; border: #eee 1rpx solid; border-radius: 10rpx;">{{cameraBrand}}</view>
        </picker>
      </view>

    </view>
    <button class="submit-btn" type="primary" bind:tap="save">立即添加设备</button>
  </view>
</view>

<van-dialog id="van-dialog" />